var express = require("express");
var router = express.Router();
var needle = require("needle");

router.get("/", function (req, res) {
  var imgUrl = req.query.imgUrl || "main";
  var img = req.query.img || "";
  res.render("home/about", { imgUrl: imgUrl, img: img });
});

router.post("/img_viewer", function (req, res) {
  var url = req.body.url;
  var imgUrl = "";

  needle.get(url, { timeout: 3000 }, function (err, res1) {
    if (!err && res1.statusCode == 200) {
      imgUrl = Buffer.from(res1.body, "utf8").toString("base64");
      res.redirect("/about?imgUrl=link&img=" + encodeURIComponent(imgUrl));
    } else {
      res.redirect("/about?imgUrl=error");
    }
  });
});

module.exports = router;
